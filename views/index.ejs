<!DOCTYPE html>
<html>
  <head>
    <title>Chat Application</title>
    <link rel="stylesheet" href="/style.css" />
  </head>
  <body>
    <div id="chat-window">
      <div id="output"></div>
      <div id="feedback"></div>
    </div>
    <div id="users"></div>
    <form id="message-form">
      <input id="message" type="text" placeholder="Message" />
      <button type="submit">Send</button>
    </form>
    <script src="/socket.io/socket.io.js"></script>
    <script>
      const socket = io();

      // Send username to server
      const username = prompt("Please enter your name");
      socket.emit('new user', username);

      // Display updated user list
      socket.on('update users', (users) => {
        let userList = '';
        for (let key in users) {
          userList += '<li>' + users[key] + '</li>';
        }
        document.getElementById('users').innerHTML = '<ul>' + userList + '</ul>';
      });

      // Submit message
      document.getElementById('message-form').addEventListener('submit', (e) => {
        e.preventDefault();
        const message = document.getElementById('message').value;
        socket.emit('chat message', message);
        document.getElementById('message').value = '';
      });

      // Display received message
      socket.on('chat message', (msg) => {
        const output = document.getElementById('output');
        const newMsg = '<p><strong>' + msg.user + ': </strong>' + msg.message + ' <em>(' + msg.time + ')</em></p>';
        output.innerHTML += newMsg;
        output.scrollTop = output.scrollHeight;
      });
    </script>
  </body>
</html>
